# Cloudflare Workers ä¾èµ–å…¼å®¹æ€§åˆ†æå’Œæ›¿ä»£æ–¹æ¡ˆ

## ä¸å…¼å®¹çš„åº“åˆ—è¡¨

### âŒ ç»å¯¹ä¸å…¼å®¹ï¼ˆå¿…é¡»ç§»é™¤ï¼‰

1. **Flask** - Workersä¸éœ€è¦Webæ¡†æ¶ï¼Œä½¿ç”¨åŸç”Ÿfetch API
2. **Werkzeug** - Flaskçš„ä¾èµ–ï¼ŒWorkersä¸éœ€è¦
3. **flask-cors** - Flaskçš„CORSæ‰©å±•ï¼ŒWorkersåŸç”Ÿæ”¯æŒCORS
4. **sqlalchemy** - ORMæ¡†æ¶ï¼ŒWorkersä½¿ç”¨D1åŸç”ŸSQL API

### âš ï¸ å¯èƒ½ä¸å…¼å®¹ï¼ˆéœ€è¦æ›¿æ¢ï¼‰

1. **pymupdf** - æœ‰Cæ‰©å±•ï¼Œå¯èƒ½ä¸å…¼å®¹Workers Pythonæ²™ç®±
2. **python-docx** - ä¾èµ–zipfileå’Œxmlï¼Œéœ€è¦æµ‹è¯•å…¼å®¹æ€§ï¼ˆå·²æä¾›çº¯Pythonæ›¿ä»£ï¼‰
3. **openpyxl** - æœ‰Cæ‰©å±•ï¼Œä¸å…¼å®¹Workersç¯å¢ƒ
4. **reportlab** - PDFç”Ÿæˆåº“ï¼Œæœ‰Cæ‰©å±•ï¼Œä¸å…¼å®¹
5. **requests** - åŒæ­¥HTTPåº“ï¼ŒWorkersç¯å¢ƒåº”ä½¿ç”¨fetchæˆ–aiohttp
6. **openai** - å®˜æ–¹åº“å¯èƒ½ä¸å…¼å®¹ï¼Œåº”ä½¿ç”¨åŸç”ŸHTTPè°ƒç”¨

## æ›¿ä»£æ–¹æ¡ˆ

### 1. Wordæ–‡æ¡£è§£æ (python-docx)

**é—®é¢˜**ï¼špython-docxå¯èƒ½ä¾èµ–æŸäº›Cæ‰©å±•æˆ–ç³»ç»Ÿåº“

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨çº¯Pythonå®ç°ï¼ˆzipfile + xml.etree.ElementTreeï¼‰

**å®ç°æ–‡ä»¶**ï¼š`utils/file_parser_cf.py`

**ä½¿ç”¨æ–¹æ³•**ï¼š
```python
from utils.file_parser_cf import extract_text_from_word

# file_dataæ˜¯bytesç±»å‹
text = extract_text_from_word(file_data)
```

**ç‰¹ç‚¹**ï¼š
- âœ… çº¯Pythonå®ç°ï¼Œæ— Cæ‰©å±•
- âœ… æ”¯æŒ.docxæ ¼å¼ï¼ˆ.docæ ¼å¼éœ€è¦è½¬æ¢ï¼‰
- âœ… æå–æ®µè½ã€è¡¨æ ¼ã€é¡µçœ‰é¡µè„š
- âœ… å…¼å®¹Workersç¯å¢ƒ

### 2. Excelæ–‡ä»¶ç”Ÿæˆ (openpyxl)

**é—®é¢˜**ï¼šopenpyxlæœ‰Cæ‰©å±•ï¼Œä¸å…¼å®¹Workersç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨CSVæ ¼å¼æ›¿ä»£Excel

**å®ç°æ–‡ä»¶**ï¼š`utils/export_cf.py`

**ä½¿ç”¨æ–¹æ³•**ï¼š
```python
from utils.export_cf import export_resumes_to_csv, export_interviews_to_csv

# å¯¼å‡ºç®€å†åˆ—è¡¨
csv_data = export_resumes_to_csv(resumes_list)

# å¯¼å‡ºé¢è¯•è®°å½•
csv_data = export_interviews_to_csv(interviews_list)

# è¿”å›Response
return Response(csv_data, headers={
    'Content-Type': 'text/csv; charset=utf-8',
    'Content-Disposition': 'attachment; filename="resumes.csv"'
})
```

**ç‰¹ç‚¹**ï¼š
- âœ… çº¯Pythonå®ç°ï¼ˆcsvæ¨¡å—ï¼‰
- âœ… CSVå¯ä»¥åœ¨Excelä¸­æ‰“å¼€
- âœ… æ”¯æŒä¸­æ–‡ï¼ˆæ·»åŠ BOMï¼‰
- âœ… æ–‡ä»¶ä½“ç§¯æ›´å°

**æ³¨æ„äº‹é¡¹**ï¼š
- CSVæ ¼å¼ä¸æ”¯æŒå¤æ‚çš„æ ¼å¼ï¼ˆé¢œè‰²ã€åˆå¹¶å•å…ƒæ ¼ç­‰ï¼‰
- å¦‚æœéœ€è¦å¤æ‚æ ¼å¼ï¼Œå»ºè®®ä½¿ç”¨å¤–éƒ¨æœåŠ¡æˆ–å®¢æˆ·ç«¯ç”Ÿæˆ

### 3. AIè°ƒç”¨ (openai)

**é—®é¢˜**ï¼šopenaiå®˜æ–¹åº“å¯èƒ½ä¸å…¼å®¹Workersç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨åŸç”Ÿfetch API

**å®ç°æ–‡ä»¶**ï¼š`utils/ai_extractor_cf.py`

**ä½¿ç”¨æ–¹æ³•**ï¼š
```python
from utils.ai_extractor_cf import AIExtractor

extractor = AIExtractor(
    api_key="your-api-key",
    api_base="https://api.openai.com/v1",  # å¯é€‰
    model="gpt-3.5-turbo"
)

# å¼‚æ­¥è°ƒç”¨
result = await extractor.extract_with_ai(text, is_word_file=False)
optimized_text = await extractor.optimize_text_extraction(text)
```

**ç‰¹ç‚¹**ï¼š
- âœ… ä½¿ç”¨WorkersåŸç”Ÿfetch API
- âœ… å®Œå…¨å¼‚æ­¥ï¼Œæ€§èƒ½æ›´å¥½
- âœ… æ”¯æŒæ‰€æœ‰å…¼å®¹OpenAI APIçš„æœåŠ¡
- âœ… æ— éœ€é¢å¤–ä¾èµ–

### 4. PDFæ–‡æœ¬æå– (pymupdf)

**é—®é¢˜**ï¼špymupdfæœ‰Cæ‰©å±•ï¼Œå¯èƒ½ä¸å…¼å®¹Workersç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **ä¼˜å…ˆæ–¹æ¡ˆ**ï¼šä½¿ç”¨AI APIå¤„ç†PDFï¼ˆæ¨èï¼‰
   - å°†PDFè½¬æ¢ä¸ºå›¾ç‰‡æˆ–ç›´æ¥å‘é€ç»™AI API
   - AI APIå¯ä»¥å¤„ç†å›¾ç‰‡PDFå’Œæ–‡æœ¬PDF

2. **å¤‡é€‰æ–¹æ¡ˆ**ï¼šä½¿ç”¨å¤–éƒ¨PDFè§£ææœåŠ¡
   - é€šè¿‡HTTP APIè°ƒç”¨å¤–éƒ¨PDFè§£ææœåŠ¡
   - æˆ–ä½¿ç”¨Cloudflareçš„PDFå¤„ç†åŠŸèƒ½ï¼ˆå¦‚æœæœ‰ï¼‰

3. **ä¸´æ—¶æ–¹æ¡ˆ**ï¼šå¦‚æœpymupdfåœ¨Workersä¸­å¯ç”¨ï¼Œç»§ç»­ä½¿ç”¨
   - éœ€è¦åœ¨Workersç¯å¢ƒä¸­æµ‹è¯•

**å®ç°æ–‡ä»¶**ï¼š`utils/file_parser_cf.py`ï¼ˆæä¾›åŸºç¡€æ¡†æ¶ï¼‰

### 5. PDFç”Ÿæˆ (reportlab)

**é—®é¢˜**ï¼šreportlabæœ‰Cæ‰©å±•ï¼Œä¸å…¼å®¹Workersç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **æ¨èæ–¹æ¡ˆ**ï¼šå®¢æˆ·ç«¯ç”ŸæˆPDF
   - ä½¿ç”¨JavaScriptåº“ï¼ˆå¦‚jsPDFï¼‰åœ¨æµè§ˆå™¨ä¸­ç”ŸæˆPDF
   - æœåŠ¡å™¨åªæä¾›æ•°æ®ï¼Œä¸ç”ŸæˆPDF

2. **å¤‡é€‰æ–¹æ¡ˆ**ï¼šä½¿ç”¨å¤–éƒ¨PDFç”ŸæˆæœåŠ¡
   - é€šè¿‡HTTP APIè°ƒç”¨å¤–éƒ¨PDFç”ŸæˆæœåŠ¡
   - æˆ–ä½¿ç”¨Cloudflareçš„PDFç”ŸæˆåŠŸèƒ½ï¼ˆå¦‚æœæœ‰ï¼‰

3. **ä¸´æ—¶æ–¹æ¡ˆ**ï¼šè¿”å›HTMLæ ¼å¼ï¼Œå®¢æˆ·ç«¯æ‰“å°ä¸ºPDF
   - ç”Ÿæˆæ ¼å¼åŒ–çš„HTML
   - ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨æ‰“å°åŠŸèƒ½ä¿å­˜ä¸ºPDF

## æ›´æ–°åçš„ä¾èµ–æ–‡ä»¶

**cf-requirements.txt** å·²æ›´æ–°ï¼Œç§»é™¤äº†æ‰€æœ‰ä¸å…¼å®¹çš„ä¾èµ–ã€‚

**æ³¨æ„**ï¼šWorkers Pythonè¿è¡Œæ—¶å·²ç»å†…ç½®äº†å¤§éƒ¨åˆ†æ ‡å‡†åº“ï¼Œå¯èƒ½ä¸éœ€è¦é¢å¤–çš„ä¾èµ–ã€‚

## ä»£ç è¿ç§»æŒ‡å—

### 1. æ–‡ä»¶è§£æ

**åŸä»£ç **ï¼š
```python
from utils.file_parser import extract_text
text = extract_text(file_path)  # éœ€è¦æ–‡ä»¶è·¯å¾„
```

**æ–°ä»£ç **ï¼š
```python
from utils.file_parser_cf import extract_text
text = extract_text(file_data, filename)  # ä½¿ç”¨æ–‡ä»¶æ•°æ®ï¼ˆbytesï¼‰
```

### 2. Excelå¯¼å‡º

**åŸä»£ç **ï¼š
```python
from utils.export import export_resumes_to_excel
wb = export_resumes_to_excel(resume)
wb.save('resume.xlsx')
```

**æ–°ä»£ç **ï¼š
```python
from utils.export_cf import export_resumes_to_csv
csv_data = export_resumes_to_csv([resume])
# è¿”å›Response
return Response(csv_data, headers={'Content-Type': 'text/csv; charset=utf-8'})
```

### 3. AIè°ƒç”¨

**åŸä»£ç **ï¼š
```python
from utils.ai_extractor import AIExtractor
extractor = AIExtractor(api_key="...")
result = extractor.extract_with_ai(text)  # åŒæ­¥è°ƒç”¨
```

**æ–°ä»£ç **ï¼š
```python
from utils.ai_extractor_cf import AIExtractor
extractor = AIExtractor(api_key="...")
result = await extractor.extract_with_ai(text)  # å¼‚æ­¥è°ƒç”¨
```

## æµ‹è¯•å»ºè®®

1. **æœ¬åœ°æµ‹è¯•**ï¼š
   ```bash
   wrangler dev
   ```

2. **æµ‹è¯•PDFè§£æ**ï¼š
   - å¦‚æœpymupdfä¸å¯ç”¨ï¼Œæµ‹è¯•AI APIå¤„ç†PDF

3. **æµ‹è¯•Wordè§£æ**ï¼š
   - æµ‹è¯•å„ç§.docxæ–‡ä»¶æ ¼å¼
   - éªŒè¯è¡¨æ ¼ã€é¡µçœ‰é¡µè„šæå–

4. **æµ‹è¯•CSVå¯¼å‡º**ï¼š
   - åœ¨Excelä¸­æ‰“å¼€CSVï¼ŒéªŒè¯ä¸­æ–‡æ˜¾ç¤º
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

5. **æµ‹è¯•AIè°ƒç”¨**ï¼š
   - æµ‹è¯•å„ç§AIæœåŠ¡ï¼ˆOpenAIã€DeepSeekç­‰ï¼‰
   - éªŒè¯å¼‚æ­¥è°ƒç”¨æ€§èƒ½

## æ€»ç»“

âœ… **å·²æä¾›çº¯Pythonæ›¿ä»£æ–¹æ¡ˆ**ï¼š
- Wordæ–‡æ¡£è§£æï¼š`utils/file_parser_cf.py`
- CSVå¯¼å‡ºï¼š`utils/export_cf.py`
- AIè°ƒç”¨ï¼š`utils/ai_extractor_cf.py`

âš ï¸ **éœ€è¦è¿›ä¸€æ­¥å¤„ç†**ï¼š
- PDFæ–‡æœ¬æå–ï¼šå»ºè®®ä½¿ç”¨AI APIæˆ–å¤–éƒ¨æœåŠ¡
- PDFç”Ÿæˆï¼šå»ºè®®å®¢æˆ·ç«¯ç”Ÿæˆæˆ–ä½¿ç”¨å¤–éƒ¨æœåŠ¡

ğŸ“ **æ³¨æ„äº‹é¡¹**ï¼š
- æ‰€æœ‰æ–°ä»£ç éƒ½ä½¿ç”¨å¼‚æ­¥APIï¼ˆasync/awaitï¼‰
- æ–‡ä»¶æ“ä½œä½¿ç”¨bytesè€Œä¸æ˜¯æ–‡ä»¶è·¯å¾„
- ä½¿ç”¨WorkersåŸç”Ÿfetch APIæ›¿ä»£requests
