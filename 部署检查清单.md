# 部署前检查清单

## ✅ 文件准备

- [x] `Procfile` - Railway/Render 启动命令
- [x] `runtime.txt` - Python 版本指定（可选）
- [x] `requirements.txt` - Python 依赖列表
- [x] `.gitignore` - Git 忽略文件配置
- [x] `app.py` - 已修改支持环境变量（PORT、HOST、DEBUG）

## ✅ 代码检查

- [x] `app.py` 支持从环境变量读取 PORT、HOST、DEBUG
- [x] 数据库路径使用相对路径（`./database.db`）
- [x] 上传目录使用相对路径（`./uploads`）
- [x] 配置文件支持环境变量（AI API 密钥等）

## ✅ 环境变量配置

需要在部署平台设置以下环境变量：

### 必需的环境变量
- `OPENAI_API_KEY` 或 `AI_API_KEY` 或 `DEEPSEEK_API_KEY` - AI API 密钥（至少一个）

### 可选的环境变量
- `AI_MODEL` - AI 模型名称（默认：gpt-3.5-turbo）
- `AI_API_BASE` - AI API Base URL（可选）
- `SECRET_KEY` - Flask session 密钥（建议设置）
- `PORT` - 端口号（Railway/Render 会自动设置）
- `HOST` - 主机地址（默认：0.0.0.0）
- `DEBUG` - 调试模式（生产环境设为 False）

## ✅ 依赖检查

确保 `requirements.txt` 包含所有必需的依赖：
- Flask
- SQLAlchemy
- PyPDF2
- python-docx
- requests
- openpyxl
- flask-cors
- openai

## ✅ 数据库准备

- [ ] 确认数据库文件路径正确（相对路径）
- [ ] 考虑是否需要迁移到 PostgreSQL（生产环境推荐）
- [ ] 准备数据库备份方案

## ✅ 文件存储准备

- [ ] 确认上传目录路径正确（相对路径）
- [ ] 考虑是否需要迁移到对象存储（S3、R2 等）
- [ ] 准备文件备份方案

## ✅ 测试检查

- [ ] 本地测试：`python app.py` 能正常启动
- [ ] 测试文件上传功能
- [ ] 测试数据库读写
- [ ] 测试 AI API 调用

## 📝 部署步骤（Railway）

1. 访问 https://railway.app
2. 注册/登录账号
3. 点击 "New Project"
4. 选择 "Deploy from GitHub repo"
5. 授权 GitHub 访问
6. 选择您的仓库
7. Railway 会自动检测 Python 项目
8. 在 Settings → Variables 中添加环境变量
9. 等待部署完成
10. 获取部署 URL

## 📝 部署步骤（Render）

1. 访问 https://render.com
2. 注册/登录账号
3. 点击 "New +" → "Web Service"
4. 连接 GitHub 仓库
5. 设置：
   - Name: 您的应用名称
   - Region: 选择区域
   - Branch: main/master
   - Root Directory: ./
   - Runtime: Python 3
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `python app.py`
6. 在 Environment 中添加环境变量
7. 点击 "Create Web Service"
8. 等待部署完成

## 🔍 部署后检查

- [ ] 应用能正常访问
- [ ] 文件上传功能正常
- [ ] 数据库读写正常
- [ ] AI API 调用正常
- [ ] 静态资源加载正常
- [ ] HTTPS 证书正常（自动配置）

## 🐛 常见问题

### 问题1：部署失败，提示找不到模块
**解决**：检查 `requirements.txt` 是否包含所有依赖

### 问题2：数据库文件丢失
**解决**：SQLite 文件会保存在服务器上，但重启可能会丢失。考虑迁移到 PostgreSQL

### 问题3：文件上传失败
**解决**：检查 `uploads/` 目录权限，确保应用有写入权限

### 问题4：AI API 调用失败
**解决**：检查环境变量是否正确设置，检查 API 密钥是否有效

### 问题5：端口错误
**解决**：确保使用环境变量 `PORT`，不要硬编码端口号



