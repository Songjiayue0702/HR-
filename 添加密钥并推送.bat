@echo off
chcp 65001 >nul
title 添加 SSH 密钥并推送代码

echo.
echo ═══════════════════════════════════════════════════════
echo          添加 SSH 密钥到 ssh-agent 并推送代码
echo ═══════════════════════════════════════════════════════
echo.
echo 注意：批处理文件在输入密码时可能有问题
echo 建议使用 PowerShell 版本（添加密钥并推送.ps1）
echo.
echo 如果您想继续使用此脚本，请确保在命令提示符（cmd）中运行
echo 而不是直接双击（双击会在 PowerShell 中运行）
echo.
pause

echo.
echo 步骤 1: 添加 SSH 密钥到 ssh-agent
echo 提示：接下来会要求您输入 SSH 密钥的密码（只需输入一次）
echo 注意：输入密码时不会显示字符，这是正常的
echo.

ssh-add "%USERPROFILE%\.ssh\id_ed25519"

if %errorlevel%==0 (
    echo.
    echo ✓ SSH 密钥已成功添加到 ssh-agent
    echo.
    
    echo ═══════════════════════════════════════════════════════
    echo 当前已加载的密钥：
    echo ═══════════════════════════════════════════════════════
    ssh-add -l
    echo.
    
    echo ═══════════════════════════════════════════════════════
    echo 步骤 2: 测试 SSH 连接
    echo ═══════════════════════════════════════════════════════
    ssh -T git@github.com
    echo.
    
    echo ═══════════════════════════════════════════════════════
    echo 步骤 3: 推送代码到 GitHub
    echo ═══════════════════════════════════════════════════════
    echo.
    git push origin main
    
    if %errorlevel%==0 (
        echo.
        echo ═══════════════════════════════════════════════════════
        echo ✓ 推送成功！
        echo ═══════════════════════════════════════════════════════
        echo.
        echo 代码已成功推送到 GitHub！
        echo 以后推送代码时，您将不再需要输入密码。
    ) else (
        echo.
        echo ═══════════════════════════════════════════════════════
        echo ✗ 推送失败
        echo ═══════════════════════════════════════════════════════
    )
) else (
    echo.
    echo ✗ 添加密钥失败
    echo.
    echo 可能的原因：
    echo 1. SSH 密钥密码输入错误
    echo 2. ssh-agent 服务未运行
    echo 3. 密钥文件路径错误
)

echo.
pause

