@echo off
chcp 65001 >nul
title SSH Agent 配置

echo.
echo ═══════════════════════════════════════════════════════
echo          SSH Agent 配置（免密推送）
echo ═══════════════════════════════════════════════════════
echo.
echo 此脚本将帮助您配置 SSH Agent，使您只需输入一次密码
echo 之后就可以免密推送代码到 GitHub
echo.
echo ═══════════════════════════════════════════════════════
echo 步骤 1: 添加 SSH 密钥到 ssh-agent
echo ═══════════════════════════════════════════════════════
echo.
echo 提示：接下来会要求您输入 SSH 密钥的密码（只需输入一次）
echo.

ssh-add "%USERPROFILE%\.ssh\id_ed25519"

if %errorlevel%==0 (
    echo.
    echo ✓ SSH 密钥已成功添加到 ssh-agent
    echo.
    
    echo ═══════════════════════════════════════════════════════
    echo 当前已加载的密钥：
    echo ═══════════════════════════════════════════════════════
    ssh-add -l
    echo.
    
    echo ═══════════════════════════════════════════════════════
    echo 步骤 2: 测试 SSH 连接
    echo ═══════════════════════════════════════════════════════
    ssh -T git@github.com
    echo.
    
    echo ═══════════════════════════════════════════════════════
    echo 步骤 3: 推送代码到 GitHub
    echo ═══════════════════════════════════════════════════════
    git push origin main
    echo.
    
    if %errorlevel%==0 (
        echo ═══════════════════════════════════════════════════════
        echo ✓ 推送成功！
        echo ═══════════════════════════════════════════════════════
    ) else (
        echo ═══════════════════════════════════════════════════════
        echo ✗ 推送失败
        echo ═══════════════════════════════════════════════════════
    )
) else (
    echo.
    echo ✗ 添加密钥失败
    echo.
    echo 可能的原因：
    echo 1. SSH 密钥密码输入错误
    echo 2. 密钥文件不存在或路径错误
    echo 3. ssh-agent 未运行
)

echo.
pause





